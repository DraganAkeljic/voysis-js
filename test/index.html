<!DOCTYPE html>
<html lang="en">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/css/bootstrap.min.css" crossorigin="anonymous">
        <script src="../src/js/voysis.js"></script>
    </head>
    <body>
        <div class="container-fluid">
            <div class="row">
                <div class="col col-xs-12 col-sm-6">
                    <button id="startStreaming" type="button" class="btn btn-primary btn-block btn-lg"
                            onclick="startStreaming()">
                        Start Streaming
                    </button>
                </div>
                <div class="col col-xs-12 col-sm-6">
                    <button id="clearMessages" type="button" class="btn btn-secondary btn-block btn-lg"
                            onclick="clearMessages()">
                        Clear Messages
                    </button>
                </div>
            </div>
            <div class="row">
                <div class="col">
                    <h3>Log Messages</h3>
                    <ul id="logMessages">
                    </ul>
                </div>
            </div>
        </div>
        <script>
            if (console.log) {
                console.log = function () {
                    var logList = document.getElementById('logMessages');
                    var newLogItem = document.createElement('li');
                    logList.appendChild(newLogItem);
                    for (var i = 0; i < arguments.length; i++) {
                        var msg = arguments[i];
                        if (typeof msg !== 'undefined') {
                            if (typeof  msg === 'function') {
                                msg = Function.prototype.toString(msg);
                            } else if (typeof  msg !== 'string') {
                                msg = JSON.stringify(msg);
                            }
                            var newLogText = document.createTextNode(msg);
                            newLogItem.appendChild(newLogText);
                        }
                    }
                };
                if (console.warn) {
                    console.warn = console.log;
                }
                if (console.error) {
                    console.error = console.log;
                }
            }
            function clearMessages() {
                var logList = document.getElementById('logMessages');
                while (logList.firstChild) {
                    logList.removeChild(logList.firstChild);
                }
            }
            function startStreaming() {
                var voysisSession = new VoysisSession({
                    refreshToken: 'f9a1ecaad566152168c49352ba2e914c01d2fbaa669c03ad94842e1f653ab550',
                    host: 'ouranos.voysis.io',
                    audioProfile: 'f8338e44-9d48-11e7-abc4-cec278b6b50a',
                    debugEnabled: true,
                    streamingAudioDeadline: 10000
                });
                console.log('Using JS library version: ', voysisSession.version);
                voysisSession.sendAudioQuery('en-us').then(function (queryResult) {
                    if (queryResult['textQuery'] && queryResult['textQuery']['text']) {
                        console.log('You said: ' + queryResult['textQuery']['text']);
                    } else {
                        console.log("No words were understood");
                    }
                }).catch(function (error) {
                    console.log("QUERY ERROR: ", error);
                });
            }
        </script>
    </body>
</html>
